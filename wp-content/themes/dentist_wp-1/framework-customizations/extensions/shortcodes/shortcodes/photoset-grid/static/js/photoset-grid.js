/**
 * photoset-grid - v1.0.1
 * 2014-04-08
 * jQuery plugin to arrange images into a flexible grid
 * http://stylehatch.github.com/photoset-grid/
 *
 * Copyright 2014 Jonathan Moore - Style Hatch
 */
!function(t,i,e,o){"use strict";function s(i,e){this.element=i,this.options=t.extend({},n,e),this._defaults=n,this._name=r,this.init()}var r="photosetGrid",n={width:"100%",gutter:"0px",highresLinks:!1,lowresWidth:500,rel:"",borderActive:!1,borderWidth:"5px",borderColor:"#000000",borderRadius:"0",borderRemoveDouble:!1,onInit:function(){},onComplete:function(){}};s.prototype={init:function(){this.options.onInit(),this._setupRows(this.element,this.options),this._setupColumns(this.element,this.options)},_callback:function(t){this.options.onComplete(t)},_setupRows:function(i,e){if(e.layout)this.layout=e.layout;else if(t(i).attr("data-layout"))this.layout=t(i).attr("data-layout");else{for(var o="",s=1,r=0;r<t(i).find("img").length;r++)o+=s.toString();this.layout=o}this.rows=this.layout.split("");for(var n in this.rows)this.rows[n]=parseInt(this.rows[n],10);var h=t(i).find("img"),a=0;t.each(this.rows,function(t,i){var e=a,o=a+i;h.slice(e,o).wrapAll('<div class="photoset-row cols-'+i+'"></div>'),a=o}),t(i).find(".photoset-row:not(:last-child)").css({"margin-bottom":e.gutter})},_setupColumns:function(e,o){var s=this,r=function(s){function r(){var i=t(e).width().toString();i!==t(e).attr("data-width")&&(n.each(function(){var i=t(this).find("img:eq(0)");t(this).find("img").each(function(){var e=t(this);e.attr("height")<i.attr("height")&&(i=t(this)),parseInt(e.css("width"),10)>o.lowresWidth&&e.attr("data-highres")&&e.attr("src",e.attr("data-highres"))});var e=i.attr("height")*parseInt(i.css("width"),10)/i.attr("width"),s=Math.floor(.025*e);o.borderActive&&t(this).find(".photoset-content-border").each(function(){t(this).css({height:e-s})}),t(this).find("img").each(function(){var i=t(this).attr("height")*parseInt(t(this).css("width"),10)/t(this).attr("width"),o=.5*(e-i)+"px";t(this).css({"margin-top":o})})}),t(e).attr("data-width",i))}var n=t(e).find(".photoset-row"),h=t(e).find("img");o.highresLinks?(h.each(function(){var i;i=t(this).attr("title")?' title="'+t(this).attr("title")+'"':"";var e;e=t(this).attr(t(this).attr("data-highres")?"data-highres":"src"),t(this).wrapAll('<a href="'+e+'"'+i+' class="photoset-cell highres-link" />'),o.borderActive&&t(this).wrapAll('<span class="photoset-content-border" />')}),o.rel&&h.parent().attr("rel",o.rel)):h.each(function(){o.borderActive?(t(this).wrapAll('<div class="photoset-cell photoset-cell--border" />'),t(this).wrapAll('<div class="photoset-content-border" />')):t(this).wrapAll('<div class="photoset-cell" />')});var a=t(e).find(".photoset-cell"),d=t(e).find(".cols-1 .photoset-cell"),l=t(e).find(".cols-2 .photoset-cell"),c=t(e).find(".cols-3 .photoset-cell"),f=t(e).find(".cols-4 .photoset-cell"),p=t(e).find(".cols-5 .photoset-cell"),u=t(e).find(".photoset-content-border");t(e).css({width:o.width}),n.css({clear:"left",display:"block",overflow:"hidden"}),a.css({"float":"left",display:"block","line-height":"0","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),h.css({width:"100%",height:"auto"}),o.borderActive&&u.css({display:"block",border:o.borderWidth+" solid "+o.borderColor,"border-radius":o.borderRadius,overflow:"hidden","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),s&&h.each(function(){t(this).attr("height",t(this).height()),t(this).attr("width",t(this).width())}),d.css({width:"100%"}),l.css({width:"50%"}),c.css({width:"33.3%"}),f.css({width:"25%"}),p.css({width:"20%"});var g=parseInt(o.gutter,10);t(e).find(".photoset-cell:not(:last-child)").css({"padding-right":g/2+"px"}),t(e).find(".photoset-cell:not(:first-child)").css({"padding-left":g/2+"px"}),o.borderRemoveDouble&&(t(e).find(".photoset-row").not(":eq(0)").find(".photoset-content-border").css({"border-top":"none"}),t(e).find(".photoset-row").not(".cols-1").find(".photoset-content-border").not(":eq(0)").css({"border-left":"none"})),r(),t(i).on("resize",function(){r()})},n=!0,h=!0;t(e).find("img").each(function(){h&=!!t(this).attr("height")&!!t(this).attr("width")}),n=!h,n?t(e).imagesLoaded(function(){r(n),s._callback(e)}):(r(n),s._callback(e))}},t.fn[r]=function(i){return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new s(this,i))})};var h="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";t.fn.imagesLoaded=function(i){function e(){var e=t(f),o=t(p);a&&(p.length?a.reject(l,e,o):a.resolve(l)),t.isFunction(i)&&i.call(n,l,e,o)}function s(t){r(t.target,"error"===t.type)}function r(i,o){i.src!==h&&-1===t.inArray(i,c)&&(c.push(i),o?p.push(i):f.push(i),t.data(i,"imagesLoaded",{isBroken:o,src:i.src}),d&&a.notifyWith(t(i),[o,l,t(f),t(p)]),l.length===c.length&&(setTimeout(e),l.unbind(".imagesLoaded",s)))}var n=this,a=t.isFunction(t.Deferred)?t.Deferred():0,d=t.isFunction(a.notify),l=n.find("img").add(n.filter("img")),c=[],f=[],p=[];return t.isPlainObject(i)&&t.each(i,function(t,e){"callback"===t?i=e:a&&a[t](e)}),l.length?l.bind("load.imagesLoaded error.imagesLoaded",s).each(function(i,e){var s=e.src,n=t.data(e,"imagesLoaded");return n&&n.src===s?void r(e,n.isBroken):e.complete&&e.naturalWidth!==o?void r(e,0===e.naturalWidth||0===e.naturalHeight):void((e.readyState||e.complete)&&(e.src=h,e.src=s))}):e(),a?a.promise(n):n};var a,d,l,c=t.event,f={_:0},p=0;a=c.special.throttledresize={setup:function(){t(this).on("resize",a.handler)},teardown:function(){t(this).off("resize",a.handler)},handler:function(i,e){var o=this,s=arguments;d=!0,l||(setInterval(function(){p++,(p>a.threshold&&d||e)&&(i.type="throttledresize",c.dispatch.apply(o,s),d=!1,p=0),p>9&&(t(f).stop(),l=!1,p=0)},30),l=!0)},threshold:0}}(jQuery,window,document);